fpt.define(["jquery","wavesurfer","jscroll","jcarousel","funcustom","general","popup","jimages","nicescroll","microservice"],function($,wavesurfer,jscroll,jcarousel,funcustom,general,popup,jimages,nicescroll,microservice){return{init:function(){common.resizeImageDetail();$(window).resize(function(){common.delayFireOnce(1E3).done(function(){common.resizeImageDetail()})});common.imageHistory();common.imageFlip();common.articleReference();common.sendMailAuthor();common.interview();common.vneRecommendation();
common.ArticleShare.init();common.ArticleShare.SocialButtonLike();common.showBoxDungBoLo();if(typeof MSArticle!="object")common.recommendation();common.trackingCTR();var _self=this;_self.initMicroservice();var pageType=$("*").find("[data-component-modulejs='detail']").attr("data-component-page-type");var config=$("*").find("[data-component-modulejs='detail']").attr("data-component-page-config");switch(pageType){case "text":_self.initDetail(config);break;case "photo":_self.initDetailPhoto(config);
break;case "tuongthuat":_self.initDetailTuongThuat(config);break;case "tongthuat":_self.initDetailTongThuat(config);break;case "interview":_self.initInterview(config);break;default:_self.initDetail(config)}$("[data-component-runtime=js]").each(function(){var func=$(this).attr("data-component-function"),input=$(this).attr("data-component-input");if(typeof func!="undefined")_self.runFunction(func,input)})},initOtherBoxs:function(){if($("#ms_samecategory").length>0)$.ajax({url:"/microservice/otherboxs/category_id/"+
$('meta[name="tt_category_id"]').attr("content"),type:"GET",dataType:"json",success:function(response){if(typeof response.same_category=="object"){var html='<div class="box_bottom_detail box_tin_khac width_common"><hgroup class="title_box_category title_box_category_2"><h4><a class="first">C\u00f9ng chuy\u00ean m\u1ee5c</a></h4></hgroup><div class="box_category box_infographics clearfix">';var i=1;var total=response.same_category.length;var current_article_id=$('meta[name="tt_article_id"]').attr("content");
$.each(response.same_category,function(index,article_detail){if(typeof article_detail.article_id!="undefined"&&parseInt(article_detail.article_id)>0){var articleIcon=parseInt(article_detail.privacy)&30;var typeIcon=common.renderTypeIcon(article_detail);var viewIcon=common.renderViewIcon(articleIcon);var viewComment=common.renderComment(article_detail);var image=common.renderImageSize(article_detail.thumbnail_url,"220x132");if(i>9)return false;if(article_detail.article_id==current_article_id)return true;
if(i<=3){html+='<article class="list_news">';if(article_detail.thumbnail_url!="")html+='<div class="thumb_art"><a class="thumb thumb_5x3" href="'+article_detail.share_url+'" title="'+article_detail.title_format+'"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" class="vne_lazy_image" data-original="'+image+'" alt="'+article_detail.title_format+'"/></a>'+typeIcon+'</div><h3 class="title_news"><a href="'+article_detail.share_url+'"> '+article_detail.title+" </a>"+
viewIcon+viewComment+"</h3>";else html+='<h3 class="title_news">'+article_detail.title+'</h3><h4 class="description">'+article_detail.lead+"</h4>";html+="</article>";if(i==total)html+="</div>"}else{if(i==4)html+='</div><div class="wrap_10_items clearfix"><ul class="list_title left">';if(i==7)html+='</ul><ul class="list_title right">';html+='<li><a href="'+article_detail.share_url+'">'+article_detail.title+" </a>"+viewIcon+viewComment+"</li>";if(i==total)html+="</ul></div>"}i++}});html+="</div>";$("#ms_samecategory").append(html);
CmtWidget.mix()}},error:function(){}})},runFunction:function(name,vnexpress_args){var fn=this[name];if(typeof fn==="function")fn(vnexpress_args,this)},initInterview:function(config){config=$.parseJSON(config);config=config[0];var intervalLoadingInterview;var callInterval=function(){if(config.isInterviewEnd==0&&config.isInterviewStart==1)intervalLoadingInterview=setInterval(function(){var time=(new Date).getTime();$.ajax({type:"GET",url:config.baseUrl+"/phong-van-truc-tuyen/loading",data:{article_id:config.article_id,
time:config.TimeInterview||0,t:time},dataType:"json",beforeSend:function(){clearInterval(intervalLoadingInterview);$("#LoadingImage").show(200)},success:function(response){if(response.time>0){var dc=$("div[id=question_answer]");config.TimeInterview=response.time;$.each(response.content,function(index,value){dc.find("#"+index).remove();dc.append('<div class="item_pvtt width_common pvtt" id="'+index+'">'+value+"</div>")});setTimeout(function(){var vConfig={"base_url":base_url,"js_url":js_url+"/v2/helper/",
"flash_url":flash_url,"site_id":site_id,"auto_play":1};common.parseVideo(vConfig)},100)}},error:function(){},complete:function(){$("#LoadingImage").hide();callInterval()}})},3E4)};if(config.isInterviewEnd==0)common.loadCaptcha("#showCaptcha_pvtt");$("#btnCancel").on("click",function(){$("#txtName, #txtOld, #txtAddress, #txtEmail, #txtQuestion, #txtCode_pvtt").val("")});callInterval();$("#btn_send").click(function(){$("span.error").empty();var success=1;if(config.isInterviewEnd==1){common.noticeAlert("Bu\u1ed5i ph\u1ecfng v\u1ea5n \u0111\u00e3 k\u1ebft th\u00fac.",
function(){});return false}var txtName=$.trim($("#txtName").val());if(txtName==""){$("#error_fullname").text("H\u1ecd t\u00ean kh\u00f4ng \u0111\u01b0\u1ee3c b\u1ecf tr\u1ed1ng");$("#txtName").focus();success=0}var txtOld=$.trim($("#txtOld").val());var txtAddress=$.trim($("#txtAddress").val());var txtEmail=$.trim($("#txtEmail").val());var emailReg=new RegExp(/^(("[\w-+\s]+")|([\w-+]+(?:\.[\w-+]+)*)|("[\w-+\s]+")([\w-+]+(?:\.[\w-+]+)*))(@((?:[\w-+]+\.)*\w[\w-+]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][\d]\.|1[\d]{2}\.|[\d]{1,2}\.))((25[0-5]|2[0-4][\d]|1[\d]{2}|[\d]{1,2})\.){2}(25[0-5]|2[0-4][\d]|1[\d]{2}|[\d]{1,2})\]?$)/i);
if(txtEmail.length<=0){$("#error_email").text("Email kh\u00f4ng \u0111\u01b0\u1ee3c b\u1ecf tr\u1ed1ng");$("#txtEmail").focus();success=0}else if(!emailReg.test(txtEmail)){$("#error_email").text("Email kh\u00f4ng h\u1ee3p l\u1ec7");$("#txtEmail").focus();success=0}var txtQuestion=$.trim($("#txtQuestion").val());if(txtQuestion==""){$("#error_question").text("C\u00e2u h\u1ecfi kh\u00f4ng \u0111\u01b0\u1ee3c b\u1ecf tr\u1ed1ng");$("#txtQuestion").focus();success=0}if(txtQuestion.length<5){$("#error_question").text("N\u1ed9i dung c\u00e2u h\u1ecfi c\u1ea7n nhi\u1ec1u h\u01a1n 5 t\u1eeb");
$("#txtQuestion").focus();success=0}var txtCode=$.trim($("#txtCode_pvtt").val());if($("#txtCode_pvtt").is(":visible")&&txtCode==""){$("#error_captcha").text("M\u00e3 x\u00e1c nh\u1eadn kh\u00f4ng ch\u00ednh x\u00e1c");$("#txtCode_pvtt").focus();success=0}if(success==0)return false;$.ajax({type:"POST",url:config.baseUrl+"/phong-van-truc-tuyen/signup",data:{article_id:config.article_id,txtName:txtName,txtOld:txtOld,txtAddress:txtAddress,txtEmail:txtEmail,txtQuestion:txtQuestion,txtCode:txtCode,captchaID:$("#captchaID2").val(),
iCode:config.iCode,iTime:config.iTime},dataType:"json",beforeSend:function(){},success:function(response){if(response.isSuccess==1){common.noticeAlert("G\u1eedi c\u00e2u h\u1ecfi th\u00e0nh c\u00f4ng.",function(){});$("#txtQuestion").val("");$("#txtCode_pvtt").val("");common.loadCaptcha("#showCaptcha_pvtt")}else if(response.isCaptchaError==1){$("#error_captcha").text("M\u00e3 x\u00e1c nh\u1eadn kh\u00f4ng ch\u00ednh x\u00e1c");success=0;$("#txtCode_pvtt").val("");$("#txtCode_pvtt").focus();common.loadCaptcha("#showCaptcha_pvtt")}else{common.noticeAlert("Kh\u00f4ng g\u1edfi \u0111\u01b0\u1ee3c c\u00e2u h\u1ecfi. Vui l\u00f2ng th\u1eed l\u1ea1i sau \u00edt ph\u00fat n\u1eefa.",
function(){});common.loadCaptcha("#showCaptcha_pvtt")}if(response.isEnd==1){common.noticeAlert("Bu\u1ed5i ph\u1ecfng v\u1ea5n \u0111\u00e3 k\u1ebft th\u00fac.",function(){});setTimeout(function(){window.location=window.location.href},5E3)}}})})},initDetailTongThuat:function(config){config=$.parseJSON(config);var req=fpt.require.config({context:config.context,baseUrl:config.baseUrl});req(["livenews"])},initDetailTuongThuat:function(config){config=$.parseJSON(config);var req=fpt.require.config({context:config.context,
baseUrl:config.baseUrl});req(["livenews"])},initDetailPhoto:function(config){if(typeof isResizedPhoto!="undefined"&&isResizedPhoto===false){common.resizeImagePhoto();$(window).resize(function(){common.delayFireOnce(1E3).done(function(){common.resizeImagePhoto()})})}var req=fpt.require.config({});req(["ImgFullscreen"],function(){sh_fullscreen.params={title:config.title,lead:config.lead,time:config.time,arrdata:config.arrdata,masterial:config.masterial,started:config.started};sh_fullscreen.run()})},
initDetail:function(config){config=$.parseJSON(config);var article_id=config.article_id;if(typeof article_id!="undefined"&&article_id>0){$(".label-contact a").removeAttr("href");$(".label-contact a").attr("href","/postarticle/datingconnect/repid/"+article_id);$(".label-contact").click(function(){window.location="/postarticle/datingconnect/repid/"+article_id})}},showComment:function(config){config=$.parseJSON(config);var req=fpt.require.config({});req(["comment"],function(){VNE.Comment.setOptions({objectid:config.article_id,
objecttype:config.article_type,siteid:config.site_id,categoryid:config.category_id,sign:config.sign,limit:config.limit});if(device_env==4){var boxComent=$("#box_coment_300 .scroll-pane");var linkVideo=$("#box_details_news").data("link-video")||false;var callback=function(){var heightComment=380;if(linkVideo)heightComment=180;var heightCommentCurrent=$("#list_comment").height();if(heightCommentCurrent<heightComment)heightComment=heightCommentCurrent;boxComent.height(heightComment);boxComent.scrollbar()}}else var callback=
function(){};VNE.Comment.getComments(callback)})},initMicroservice:function(){if("undefined"!=typeof Microservice){Microservice.SITE_URL="https://ms-saas.vnexpress.net";Microservice.URL=js_url+"/v2/helper";Microservice.SITE_ID=SITE_ID;return Microservice.initAll()}},initMail:function(config){$(".open-popup-link").magnificPopup({type:"inline",midClick:true,mainClass:"mfp-with-zoom",fixedContentPos:false,fixedBgPos:true,overflowY:"auto",closeBtnInside:true,preloader:false,removalDelay:300});$("#sender_email").on("keyup blur",
common.mail.validateEmail);$("#sender_name").on("keyup blur",common.mail.validateName);$("#receiver_mail").on("keyup blur",common.mail.validateReceiver);$("#txtCode").on("keyup blur",common.mail.validateCode);$(".login_5").click(function(event){common.loadCaptcha("#showCaptcha");$.magnificPopup.open({items:{src:"#email-popup",type:"inline"}})});$(".btn_submit_form").click(function(event){common.mail.send()})},boxRecommendationDetail:function(config){config=$.parseJSON(config);var medium="";if(config.category_id==
1001002)medium="TheGioi";else if(config.category_id==1001006)medium="Xe";if(chosenVariation==0){chosenLabel="A";$("#box_xemnhieunhat").show()}else if(chosenVariation==1){chosenLabel="B";var a=/(^|;)[ ]*fosp_aid=([^;]*)/.exec(document.cookie),a=a&&window.decodeURIComponent(a[2]);if(!a||a=="undefinder")a=(WNMatch=/(^|&)[ ]*fosp_aid=([^&]*)/.exec(window.name))&&window.decodeURIComponent(WNMatch[2]);a=a.replace(/"|'/g,"").substr(0,16);$.ajax({url:"//ps.vnexpress.net/a",data:{sid:config.category_id,size:2,
fosp_aid:a,limit:5,r:Math.random(),aid:config.article_id},async:!0,dataType:"json",crossDomain:!0,xhrFields:{withCredentials:!0},success:function(a){a=a.data||[];var d=$("#box_recommendation_detail"),e={2:"ic-video",4:"ic-photo"};var html="";$.each(a,function(a,b){html+='<li><a href="'+b.share_url.replace(/http:\/\//gi,"//")+'#cvar=B" title="'+b.title+'">'+b.title+"</a>";$.each(e,function(a,d){0<(b.privacy&parseInt(a))&&(html+=' <i class="ic '+d+'"></i>')});html+="</li>"});if(html!=""){d.html('<hgroup class="title_box_category"><h4><a title="xem nhi\u1ec1u" href="javascript:;" class="first">Xem nhi\u1ec1u</a></h4></hgroup><ul class="list_title">'+
html+"<ul/>");d.show()}}})}},initBoxSPLienQuan:function(){var $box_splienquan=$("#box_splienquan");if($box_splienquan.length>0){var listTags=$box_splienquan.data("tags");if(typeof listTags!="undefined"&&listTags!=""){listTags=decodeURIComponent(listTags).replace(/,\+/g,",");var l_item=10;var cate_name="vnexpress";var mn_active=$("#main_menu .active").length<=0?"":$("#main_menu .active").attr("class").replace("active","").replace("mnu_","").trim();if(mn_active){var map_cate={"thoisu":"thoi-su","thegioi":"the-gioi",
"phapluat":"phap-luat","giaoduc":"giao-duc","xe":"xe","khoahoc":"khoa-hoc","congdong":"cong-dong","tamsu":"tam-su","kinhdoanh":"kinh-doanh","giaitri":"giai-tri","thethao":"the-thao","suckhoe":"suc-khoe","doisong":"doi-song","dulich":"du-lich","sohoa":"so-hoa"};if("undefined"!=typeof map_cate[mn_active])cate_name=map_cate[mn_active]}$.ajax({url:"https://shop.vnexpress.net/api/shop_vne?keywords="+listTags,type:"GET",data:{action:"search_keywords",cate_name:cate_name,limit:l_item,token:"dngodvdisadWWoGGHHSkAJjnnnsksdllldsjij"},
type:"GET",dataType:"jsonp",jsonpCallback:"shopdetailCallback",cache:true,success:function(data){if(typeof data.products!="undefined"&&data.products.length>0){var count_products=data.products.length;var tpl_item='<div class="item"><div class="avata"><a href="{URL}" title="{NAME}" target="_blank"><img src="{THUMB}" alt="{NAME}"/></a></div><div class="conten"><h3><a href="{URL}" title="{NAME}" target="_blank">{NAME}</a></h3><div class="price"><p class="new">{PRICE}</p></div>{SEE_DETAIL}</div></div>';
var html_items="";var j=0;$.each(data.products,function(k,item){if(typeof item.name!="undefined"&&typeof item.url!="undefined"&&typeof item.thumbnail!="undefined"&&typeof item.price!="undefined"){var i=tpl_item;i=i.replace(/\{NAME\}/g,item.name);i=i.replace(/\{URL\}/g,item.url);i=i.replace(/\{THUMB\}/g,item.thumbnail);i=i.replace(/\{PRICE\}/g,item.price);if(count_products==1)i=i.replace(/\{SEE_DETAIL\}/g,'<div class="detail"><a href="'+item.url+'" target="_blank">Xem chi ti\u1ebft</a></div><a class="web" href="https://shop.vnexpress.net" target="_blank" title="ShopVnExpress">shop.vnexpress.net</a>');
else i=i.replace(/\{SEE_DETAIL\}/g,"");html_items+=i;j++;if(j>=l_item){count_products=j;return false}}else count_products--});if(count_products>0){var class_box="box_4item owl-carousel";switch(count_products){case 1:class_box="box_1item";break;case 2:class_box="box_2item";break;case 3:class_box="box_3item";break;default:break}$box_splienquan.html('<div id="box_splienquan2017" class="width_common mg_bottom_20"><div class="title"><a href="https://shop.vnexpress.net" target="_blank" title="Shop VnExpress">Shop VnExpress</a></div><div class="width_common '+
class_box+'">'+html_items+"</div></div>");if(count_products>3){$("#box_splienquan2017").append('<a href="javascript:;" class="btn_next"><i class="ic ic-caret-right"></i></a><a href="javascript:;" class="btn_prev"><i class="ic ic-caret-right"></i></a>');var $owl_splq=$("#box_splienquan2017 .owl-carousel");$owl_splq.owlCarousel({loop:false,autoplay:false,autoplayTimeout:7E3,margin:10});$("#box_splienquan2017 .btn_next").click(function(){$owl_splq.trigger("next.owl.carousel")});$("#box_splienquan2017 .btn_prev").click(function(){$owl_splq.trigger("prev.owl.carousel")})}}}}})}}}}});